# **URL Shortener**

## **üìå –ó–∞–¥–∞–Ω–∏–µ**

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π API –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —Å–æ–∫—Ä–∞—â—ë–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫.

### **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å—Å—ã–ª–∫–µ**
- **–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å**: –Ω–∞ –æ–¥–∏–Ω –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL –¥–æ–ª–∂–Ω–∞ —Å—Å—ã–ª–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Å–æ–∫—Ä–∞—â—ë–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞.
- **–î–ª–∏–Ω–∞**: 10 —Å–∏–º–≤–æ–ª–æ–≤.
- **–§–æ—Ä–º–∞—Ç**: –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã –≤ –≤–µ—Ä—Ö–Ω–µ–º –∏ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ, —Ü–∏—Ñ—Ä—ã, —Å–∏–º–≤–æ–ª `_` (–ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ).

### **API (HTTP)**
1. **POST** `/api/v1/shorten` ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL –≤ –±–∞–∑–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–∫—Ä–∞—â—ë–Ω–Ω—ã–π.
2. **GET** `/api/v1/resolve/{shortened}` ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–∫—Ä–∞—â—ë–Ω–Ω—ã–π URL –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π.
–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:8080/api/v1/docs/index.html`
### **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ, –Ω–æ –∂–µ–ª–∞–µ–º—ã–µ —É—Å–ª–æ–≤–∏—è)**
‚úî **gRPC API** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `proto` –∏ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã.

---

## **üìå –†–µ–∞–ª–∏–∑–∞—Ü–∏—è**
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Å–æ–≥–ª–∞—Å–Ω–æ –∑–∞–¥–∞–Ω–∏—é, –∞ —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã:
- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Redis** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –≤–∫–ª—é—á–∞–µ—Ç—Å—è —Ñ–ª–∞–≥–æ–º `-redis`).
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** (—Ä–∞–∑–º–µ—â–µ–Ω—ã –≤ `tests/`).
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger** –¥–ª—è —É–¥–æ–±–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ API.

---

## **üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞**

### **1Ô∏è‚É£ –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è**
```bash
git clone git@github.com:Promakash/ozon_task.git
cd ozon_task
```

### **2Ô∏è‚É£ –ó–∞–ø—É—Å–∫**
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞:
- `-redis` ‚Äî –≤–∫–ª—é—á–∞–µ—Ç **–∫–µ—à Redis** (—Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥–Ω—è—Ç—ã–µ Redis –∏ PostgreSQL).
- `-inmem` ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å **in-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º** –≤–º–µ—Å—Ç–æ PostgreSQL.

–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `Makefile`.

```bash
# –ë–∏–ª–¥ Docker-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
make build
```

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make run
```

```bash
# –ó–∞–ø—É—Å–∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
make run_tests
```

---

## **‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**
–ö–æ–Ω—Ñ–∏–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ–ø–∏—Å–∞–Ω –Ω–∏–∂–µ

### **üìå HTTP-—Å–µ—Ä–≤–µ—Ä**
| –ü–∞—Ä–∞–º–µ—Ç—Ä              | –ó–Ω–∞—á–µ–Ω–∏–µ   | –û–ø–∏—Å–∞–Ω–∏–µ                    |
|----------------------|-----------|-----------------------------|
| `address`           | `":8080"`  | –ê–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞               |
| `read_timeout`      | `5s`       | –¢–∞–π–º–∞—É—Ç —á—Ç–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞      |
| `write_timeout`     | `5s`       | –¢–∞–π–º–∞—É—Ç –∑–∞–ø–∏—Å–∏ –æ—Ç–≤–µ—Ç–∞       |
| `idle_timeout`      | `30s`      | –¢–∞–π–º–∞—É—Ç –ø—Ä–æ—Å—Ç–æ—è             |
| `operations_timeout`| `4s`       | –¢–∞–π–º–∞—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π |

### **üìå gRPC-—Å–µ—Ä–≤–µ—Ä**
| –ü–∞—Ä–∞–º–µ—Ç—Ä              | –ó–Ω–∞—á–µ–Ω–∏–µ   | –û–ø–∏—Å–∞–Ω–∏–µ                    |
|----------------------|-----------|-----------------------------|
| `port`              | `5050`     | –ü–æ—Ä—Ç gRPC-—Å–µ—Ä–≤–µ—Ä–∞           |
| `operations_timeout`| `5s`       | –¢–∞–π–º–∞—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π |

### **üìå PostgreSQL (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)**
| –ü–∞—Ä–∞–º–µ—Ç—Ä   | –ó–Ω–∞—á–µ–Ω–∏–µ   | –û–ø–∏—Å–∞–Ω–∏–µ         |
|------------|-----------|------------------|
| `host`     | `storage` | –•–æ—Å—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |
| `port`     | `5432`    | –ü–æ—Ä—Ç PostgreSQL  |
| `user`     | `postgres`| –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `password` | `password`| –ü–∞—Ä–æ–ª—å           |
| `db_name`  | `postgres`| –ù–∞–∑–≤–∞–Ω–∏–µ –±–¥      |

### **üìå Redis (–µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω –∫—ç—à)**
| –ü–∞—Ä–∞–º–µ—Ç—Ä        | –ó–Ω–∞—á–µ–Ω–∏–µ  | –û–ø–∏—Å–∞–Ω–∏–µ                     |
|----------------|----------|-----------------------------|
| `host`        | `cache`  | –•–æ—Å—Ç Redis                  |
| `port`        | `6379`   | –ü–æ—Ä—Ç Redis                  |
| `password`    | `redis`  | –ü–∞—Ä–æ–ª—å Redis                |
| `TTL`         | `1h`     | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫—ç—à–∞            |
| `write_timeout` | `3s`    | –¢–∞–π–º–∞—É—Ç –∑–∞–ø–∏—Å–∏ –≤ Redis      |
| `read_timeout` | `500ms`  | –¢–∞–π–º–∞—É—Ç —á—Ç–µ–Ω–∏—è –∏–∑ Redis     |

### **üìå –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
| –ü–∞—Ä–∞–º–µ—Ç—Ä    | –ó–Ω–∞—á–µ–Ω–∏–µ      | –û–ø–∏—Å–∞–Ω–∏–µ                                                 |
|------------|--------------|----------------------------------------------------------|
| `level`    | `debug`      | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–æ–≤ (`debug`, `info`, `error`)(default = info) |
| `format`   | `json`       | –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤ (`json`, `plain`) (default = text)          |
| `directory`| `/app/logs`  | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –ª–æ–≥–æ–≤ –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ (default = "")  |

---

## **üìú –ü—Ä–∏–º–µ—Ä—ã API-–∑–∞–ø—Ä–æ—Å–æ–≤**
### **üìç –°–æ–∑–¥–∞—Ç—å —Å–æ–∫—Ä–∞—â—ë–Ω–Ω—É—é —Å—Å—ã–ª–∫—É**
```bash
curl -X POST http://localhost:8080/api/v1/shorten \
     -H "Content-Type: application/json" \
     -d '{"original_url": "https://example.com"}'
```
üì§ **–û—Ç–≤–µ—Ç**:
```json
{
  "shortened_url": "xYz_123AbC"
}
```

### **üìç –ü–æ–ª—É—á–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –ø–æ —Å–æ–∫—Ä–∞—â–µ–Ω–Ω–æ–π**
```bash
curl -X GET http://localhost:8080/api/v1/resolve/xYz_123AbC
```
üì§ **–û—Ç–≤–µ—Ç**:
```json
{
  "original_url": "https://example.com"
}
```

